App.Views.Shared={EnableBacklogEstimationPreferences:function(a,b){var c=b=="backlog"?"":"_default",d=!1,e=function(){$("input#"+b+"_days_estimatable_false").is(":checked")?(a.find("#"+b+c+"_velocity").rules("add",{required:!1}),a.find("input#velocity_was").val(a.find("input#"+b+c+"_velocity").val()),a.find("input#rate_was").val(a.find("input#"+b+c+"_rate").val()),a.find("input#"+b+c+"_velocity, input#"+b+c+"_rate").val(""),a.find(".cost-elements").hide(),a.find("#days_estimatable_false_label").addClass("selected"),a.find("#days_estimatable_true_label").removeClass("selected")):(a.find("input#"+b+c+"_velocity").rules("add",{required:!0}),a.find("input#velocity_was").val()&&a.find("input#"+b+c+"_velocity").val(a.find("input#velocity_was").val()),a.find("input#rate_was").val()&&a.find("input#"+b+c+"_rate").val(a.find("input#rate_was").val()),a.find("#days_estimatable_true_label").addClass("selected"),a.find("#days_estimatable_false_label").removeClass("selected"),a.find(".cost-elements").slideDown())};return!d&&a.find("input#"+b+"_days_estimatable_false").is(":checked")&&_.include(["","false","f"],a.find("input#account_defaults_set").val())&&($("input#"+b+"_days_estimatable_true").attr("checked",!0),d=!0),e(),$("input#"+b+"_days_estimatable_false, input#"+b+"_days_estimatable_true").change(function(){e()}),e}},App.Views.BacklogCreateUpdateMethods=function(){function b(){var b=$("form#new_backlog, form.edit_backlog");b.validate({rules:{"backlog[name]":{required:!0},"backlog[rate]":{number:!0,min:0},"backlog[velocity]":{number:!0,min:.1}},messages:{"backlog[name]":{required:"You must enter a backlog name",remote:"That backlog name is already taken.  Please enter another name"},"backlog[velocity]":{min:"Please enter a velocity greater than zero"}},success:function(a){a.html("&nbsp;").addClass("correct")}}),a=App.Views.Shared.EnableBacklogEstimationPreferences(b,"backlog"),d(),$("input#backlog_has_company_false, input#backlog_has_company_true").change(function(){c()}),$("a#add_new_company").click(function(a){a.preventDefault(),$(".client-select .existing").hide(),$(".client-select .new").show(),e(),$("input#company_name").focus()}),$("a#select_an_existing_company").click(function(a){a.preventDefault(),$("input#company_name").val(""),$(".client-select .existing").show(),$(".client-select .new").hide(),f(),$("select#backlog_company_id").focus()}),$(".client-select .existing select option").length===0&&$(".client-select .new .select-existing").hide(),$(".not-editable-notice").length&&($('input[type=text],input[type=checkbox],input[name="backlog[scoring_rule_id]"],select').attr("disabled",!0),$("#backlog_has_company_false, #backlog_has_company_true").attr("disabled",!0),$(".client-select .new-company").hide(),$(".not-editable-notice").is(".no-permission")&&$("input[type=radio]").attr("disabled",!0)),c(!0),$("select#backlog_company_id").change(function(){f()})}function c(a){$("input#backlog_has_company_false").is(":checked")?($(".client-select, .client-select .existing, .client-select .new").hide(),$("#has_company_false_label").addClass("selected"),$("#has_company_true_label").removeClass("selected"),e(a)):($("#has_company_true_label").addClass("selected"),$("#has_company_false_label").removeClass("selected"),$(".client-select").show(),$("#backlog_company_id option").length>0?($(".client-select .existing").css("height","auto").slideDown(),$("select#backlog_company_id").focus(),f(a)):($(".client-select .new").css("height","auto").slideDown(),$(".client-select .existing").hide(),$("input#company_name").focus(),e(a)))}function d(){$("input#backlog_rate").data("default",$("input#backlog_rate").val()),$("input#backlog_velocity").data("default",$("input#backlog_velocity").val()),$("input#backlog_use_50_90").data("default",$("input#backlog_use_50_90").attr("checked"))}function e(a){h()||($("input#backlog_rate").val($("input#backlog_rate").data("default")),$("input#backlog_velocity").val($("input#backlog_velocity").data("default")),$("input#backlog_use_50_90").attr("checked",$("input#backlog_use_50_90").data("default")),a||g())}function f(a){if(!h()){var b=$("select#backlog_company_id option:selected").val(),c=document.location.href.match(/\/accounts\/(\d+)\//i);$.getJSON("/accounts/"+c[1]+"/companies/"+b+".json",{},function(b){$("input#backlog_rate").val(b.default_rate),$("input#backlog_velocity").val(b.default_velocity),$("input#backlog_use_50_90").attr("checked",b.default_use_50_90),a||g()})}}function g(){$("input#backlog_velocity").val()?$("input#backlog_days_estimatable_true").attr("checked",!0):$("input#backlog_days_estimatable_false").attr("checked",!0),a()}function h(){return $("form.edit_backlog").length>0}var a;return{initializeManageBacklog:b}}();